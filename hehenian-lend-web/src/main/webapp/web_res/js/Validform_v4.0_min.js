/*
    Validform version 4.0
	For more information, please visit http://validform.rjboy.cn
	By sean during April 7, 2010 - March 30, 2012
*/

(function(d){var e=null,c,b=true,a={tit:"提示信息",w:"请输入正确信息！",r:"通过信息验证！",c:"正在检测信息…",s:"请填入信息！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…",err:"出错了！请检查提交地址或返回数据格式是否正确！",security:"安全错误，您不能提交表单！"},f=function(){if(d("#Validform_msg").length!==0){return false}c=d('<div id="Validform_msg"><div class="Validform_title">'+a.tit+'<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");c.find("a.Validform_close").click(function(){c.hide();b=true;if(e){e.focus().addClass("Validform_error")}return false}).focus(function(){this.blur()});d(window).bind("scroll resize",function(){if(!b){var i=(d(window).width()-c.outerWidth())/2,h=(d(window).height()-c.outerHeight())/2,g=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(h>0?h:0);c.animate({left:i,top:g},{duration:400,queue:false})}})};d.Tipmsg=a;d.fn.Validform=function(g){var h={};g=d.extend({},d.fn.Validform.sn.defaults,g);g.datatype&&d.extend(d.Datatype,g.datatype);this.each(function(k){var o=d(this),n=o.find("[datatype]").length,j=false;o.find("[tip]").each(function(){var r=d(this).attr("tip");var q=d(this).attr("altercss");d(this).focus(function(){if(d(this).val()==r){d(this).val("");if(q){d(this).removeClass(q)}}}).blur(function(){if(d.trim(d(this).val())===""){d(this).val(r);if(q){d(this).addClass(q)}}})});o.find("input[recheck]").each(function(){var r=d(this);var q=o.find("input[name='"+d(this).attr("recheck")+"']");q.bind("keyup",function(){if(q.val()==r.val()&&q.val()!=""){if(q.attr("tip")){if(q.attr("tip")==q.val()){return false}}r.trigger("blur")}}).bind("blur",function(){if(q.val()!=r.val()&&r.val()!=""){if(r.attr("tip")){if(r.attr("tip")==r.val()){return false}}r.trigger("blur")}})});if(g.usePlugin){if(g.usePlugin.swfupload){var l=o.find("input[plugin='swfupload']").val(""),m={custom_settings:{form:o,showmsg:function(r,q){d.fn.Validform.sn.showmsg(r,g.tiptype,{obj:l,type:q})}}};m=d.extend(true,{},g.usePlugin.swfupload,m);if(typeof(swfuploadhandler)!="undefined"){swfuploadhandler.init(m,k)}}if(g.usePlugin.datepicker){if(g.usePlugin.datepicker.format){Date.format=g.usePlugin.datepicker.format;delete g.usePlugin.datepicker.format}if(g.usePlugin.datepicker.firstDayOfWeek){Date.firstDayOfWeek=g.usePlugin.datepicker.firstDayOfWeek;delete g.usePlugin.datepicker.firstDayOfWeek}var p=o.find("input[plugin='datepicker']");g.usePlugin.datepicker.callback&&p.bind("dateSelected",function(){var q=new Date(d.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);g.usePlugin.datepicker.callback(q,this)});p.datePicker(g.usePlugin.datepicker)}if(g.usePlugin.passwordstrength){g.usePlugin.passwordstrength.showmsg=function(r,s,q){d.fn.Validform.sn.showmsg(s,g.tiptype,{obj:r,type:q,sweep:g.tipSweep},"hide")};o.find("input[plugin*='passwordStrength']").passwordStrength(g.usePlugin.passwordstrength)}}o.find("[datatype]").blur(function(){var r=true;r=d.fn.Validform.sn.checkform(d(this),o,{type:g.tiptype,sweep:g.tipSweep},"hide");if(!r){return false}if(typeof(r)!="boolean"){d(this).removeClass("Validform_error");return false}r=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val(),d(this));if(!r){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){if(g.tiptype==2){var s=d(this).parent().next().find(".Validform_checktip");if(s.is(".Validform_right")){s.text(d(this).attr("errormsg"))}s.removeClass().addClass("Validform_checktip")}else{if(typeof g.tiptype=="function"){(g.tiptype)("",{obj:d(this),type:4},d.fn.Validform.sn.cssctl)}}r=true;e=null;return true}d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),type:3,sweep:g.tipSweep},"hide")}else{if(d(this).attr("ajaxurl")){var t=d(this);var q=arguments[1];if(t.attr("valid")=="posting"){return false}t.attr("valid","posting");d.fn.Validform.sn.showmsg(a.c,g.tiptype,{obj:t,type:1,sweep:g.tipSweep},"hide");d.ajax({type:"POST",url:t.attr("ajaxurl")+"?"+(new Date()).getTime(),data:"param="+d(this).val()+"&name="+d(this).attr("name"),dataType:"text",success:function(u){if(d.trim(u)=="y"){t.attr("valid","true");d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:t,type:2,sweep:g.tipSweep},"hide");if(q==="postform"){o.trigger("submit")}}else{t.attr("valid",u);d.fn.Validform.sn.showmsg(u,g.tiptype,{obj:t,type:3,sweep:g.tipSweep})}},error:function(){t.attr("valid",a.err);d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:t,type:3,sweep:g.tipSweep})}})}else{d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),type:2,sweep:g.tipSweep},"hide")}}});o.find(":checkbox[datatype],:radio[datatype]").each(function(){var r=d(this);var q=r.attr("name");o.find("[name='"+q+"']").filter(":checkbox,:radio").bind("click",function(){r.trigger("blur")})});var i=function(){if(n!=o.find("[datatype]").length){d.Showmsg(a.security);return false}var q=true,r=true;if(j){return false}o.find("[datatype]").each(function(){r=d.fn.Validform.sn.checkform(d(this),o,{type:g.tiptype,sweep:g.tipSweep});if(!r){if(!g.showAllError){e.focus();q=false;return false}q&&(q=false);return true}if(typeof(r)!="boolean"){return true}r=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val(),d(this));if(r&&d(this).is("[datatype*='option_']")){d(this).trigger("blur")}if(!r){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){e=null;return true}d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),type:3,sweep:g.tipSweep});if(!g.showAllError){e.focus();q=false;return false}q&&(q=false);return true}if(d(this).attr("ajaxurl")){if(d(this).attr("valid")!="true"){var s=d(this);d.fn.Validform.sn.showmsg(a.v,g.tiptype,{obj:s,type:3,sweep:g.tipSweep});if(!b||g.tiptype!=1){setTimeout(function(){s.trigger("blur",["postform"])},1500)}if(!g.showAllError){q=false;return false}q&&(q=false);return true}else{d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),type:2,sweep:g.tipSweep},"hide")}}});if(g.showAllError){o.find(".Validform_error:first").focus()}if(q&&!j){e=null;if(g.postonce){j=true}if(g.ajaxPost){d.fn.Validform.sn.showmsg(a.p,g.tiptype,{obj:o,type:1,sweep:g.tipSweep},"alwaysshow");d.ajax({type:"POST",dataType:"json",url:o.attr("action")+"?"+(new Date()).getTime(),data:decodeURIComponent(o.serialize(),true),success:function(s){if(s.status==="y"){d.fn.Validform.sn.showmsg(s.info,g.tiptype,{obj:o,type:2,sweep:g.tipSweep},"alwaysshow")}else{j=false;d.fn.Validform.sn.showmsg(s.info,g.tiptype,{obj:o,type:3,sweep:g.tipSweep},"alwaysshow")}g.callback&&g.callback(s)},error:function(){j=false;d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:o,type:3,sweep:g.tipSweep},"alwaysshow")}});return false}else{g.callback?g.callback(o):o.get(0).submit()}}};g.btnSubmit&&o.find(g.btnSubmit).bind("click",i);o.submit(function(){i();return false});o.find("input[type='reset']").click(function(){o.find(".Validform_right").text("");o.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");o.find(".Validform_error").removeClass("Validform_error");o.find("input:first").focus()})});if(g.tiptype==1||(g.tiptype==2&&g.ajaxPost)){f()}};d.fn.Validform.sn={defaults:{tiptype:1,tipSweep:false,showAllError:false,postonce:false,ajaxPost:false},toString:Object.prototype.toString,regcheck:function(i,l,k){if(this.toString.call(d.Datatype[i])=="[object Function]"){return(d.Datatype[i])(l,k)}if(!(i in d.Datatype)){var n=i.match(d.Datatype.match),g;reg:for(var h in d.Datatype){g=h.match(d.Datatype.match);if(!g){continue reg}if(n[1]===g[1]){var m=d.Datatype[h].toString();var j=new RegExp("\\{"+g[2]+","+g[3]+"\\}");m=m.replace(j,"{"+n[2]+","+n[3]+"}").replace(/^\//,"").replace(/\/$/,"");d.Datatype[i]=new RegExp(m);break reg}}}if(this.toString.call(d.Datatype[i])=="[object RegExp]"){return d.Datatype[i].test(l)}return false},showmsg:function(l,h,k,g){if(k.type==3&&!k.obj.is("form")){e=k.obj}else{e&&e.removeClass("Validform_error");e=null}e&&e.addClass("Validform_error");if(typeof h=="function"){if(!(k.sweep&&g=="hide")){h(l,k,this.cssctl)}return false}if(h==1||g=="alwaysshow"){c.find(".Validform_info").text(l)}if(h==1&&g!="hide"||g=="alwaysshow"){b=false;c.find(".iframe").css("height",c.outerHeight());var j=(d(window).width()-c.outerWidth())/2;var i=(d(window).height()-c.outerHeight())/2;i=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(i>0?i:0);c.css({left:j}).show().animate({top:i},100)}if(h==2&&k.obj){k.obj.parent().next().find(".Validform_checktip").text(l);this.cssctl(k.obj.parent().next().find(".Validform_checktip"),k.type)}},checkform:function(k,j,g,o){var l=k.attr("errormsg")||a.w,i;if(k.is("[datatype='radio']")){i=k.attr("name");var n=j.find(":radio[name='"+i+"']:checked").val();if(!n){this.showmsg(l,g.type,{obj:k,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"radio"}if(k.is("[datatype='checkbox']")){i=k.attr("name");var m=j.find(":checkbox[name='"+i+"']:checked").val();if(!m){this.showmsg(l,g.type,{obj:k,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"checkbox"}if(k.is("[datatype='select']")){if(!k.val()){this.showmsg(l,g.type,{obj:k,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"select"}if(k.is("[datatype*='option_']")){k.removeClass("Validform_error");e=null;return true}var p=k.attr("tip");if((d.trim(k.val())===""||k.val()===p)&&k.attr("ignore")!="ignore"){this.showmsg(k.attr("nullmsg")||a.s,g.type,{obj:k,type:3,sweep:g.sweep},o);return false}if(k.attr("recheck")){var h=j.find("input[name='"+k.attr("recheck")+"']:first");if(k.val()!=h.val()){this.showmsg(l,g.type,{obj:k,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide")}k.removeClass("Validform_error");e=null;return true},cssctl:function(h,g){switch(g){case 1:h.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:h.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:h.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:h.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}}};d.Showmsg=function(g){f();d.fn.Validform.sn.showmsg(g,1,{})};d.Hidemsg=function(){c.hide();b=true};d.Datatype={match:/^(.+)(\d+)-(\d+)$/,"*":/.+/,"*6-16":/^.{6,16}$/,n:/^\d+$/,"n6-16":/^\d{6,16}$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/m,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,url:/^(\w+:\/\/)?\w+(\.\w+)+$/}})(jQuery);